<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../favicon.ico">
  <title>Pixel Artists by Blackspike.com</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>

  <style>

    :root {
      --pixel-size: 1rem;
      --pixel-rows: 43;
      --pixel-cols: 34;

      --c-bg:hsl(247,43%,13%);
      --c-fg: white;

      --c-input-bg:hsl(247,43%,23%);
      --c-input-fg: #eee;

      --mw: 610px;

      --ff-mono: ui-monospace, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono", "Roboto Mono", "Oxygen Mono", "Ubuntu Monospace", "Source Code Pro", "Fira Mono", "Droid Sans Mono", "Courier New", monospace;

    }

    html {
      box-sizing: border-box;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }

    body {
      background-color: var(--c-bg);
      color: var(--c-fg);
      width: 100%;
      height: 100vh;
      display: grid;
      justify-content: center;
      margin: 0;
      padding: 0;
    }

    .wrapper {
      height: 100vh;
      display: grid;
      grid-template-columns: 1fr;
      grid-template-rows: 1fr auto;
      gap: .25rem;
      font-family: var(--ff-mono);
      padding: 1rem 0;
      max-width: var(--mw);
      margin: auto;
    }

    @media screen and (min-width: 600px) {

      .wrapper {
        gap: 2rem;
        padding: 2rem 0;
      }
    }
    /* Spinner
    ============================= */

    @keyframes spin {
      0% {transform: rotate(0);}
      100% {transform: rotate(1turn);}
    }

    .spinner {
      pointer-events: none;
      animation: spin .5s infinite linear;
      grid-column: 1;
      grid-row: 1;
      justify-self: center;
      align-self: center;
      position: relative;
      z-index: 5;
      opacity: 0;
      transition: opacity .5s ease;
    }

    .loading .spinner {
      opacity: 1;
    }

    /* Error
    ============================= */

    .error {
      pointer-events: none;
      grid-column: 1;
      grid-row: 1;
      position: relative;
      font-size: 20px;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-self: center;
      align-self: center;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      background-color: hsl(247,43%,8%);
      z-index: 15;
      opacity: 0;
      transition: opacity .5s ease;
      border-radius: 1rem;
    }
    .error.error-show {
      opacity: 1;
      pointer-events: all;
    }

    .error-details {
      margin-top: 2rem;
      opacity: .5;
      text-align: left;
    }



    /* Art
    ============================= */

    .art-wrapper {
      overflow: hidden;
      position: relative;
      z-index: 10;
      grid-column: 1;
      grid-row: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .art {
      display: grid;
      grid-template-columns: repeat(var(--pixel-cols), var(--pixel-size));
      grid-gap: 2px;
      cursor: pointer;
      margin: auto;
    }

    @media screen and (max-width: 600px) {

      .art {
        --pixel-size: calc(80vw / var(--pixel-cols));
        grid-template-columns: repeat(var(--pixel-cols), var(--pixel-size));
      }
    }

    .pixel {
      width: var(--pixel-size);
      height: var(--pixel-size);
      border-radius: 50%;
      opacity: 0;
    }

    /* Footer
    ============================= */

    .footer-content {
      background-color: var(--c-bg);
    }

    /* Form
    ============================= */

    .image-form {
      width: 100%;
      display: grid;
      grid-template-columns: 1fr;
      grid-gap: .5rem;
      grid-column: 1;
      grid-row: 2;
    }
    .image-form__url {
      grid-column: 1;
      grid-row: 2;
      font-size: 1rem;
      padding: .75rem;
      font-family: var(--ff-mono);
      border: none;
      border-radius: .25rem;
      background-color: var(--c-input-bg);
      color: var(--c-input-fg);
    }

    @media screen and (min-width: 600px) {

     .image-form__url {
       font-size: 1.25rem;
      }
    }


    .btn {
      all: unset;
      box-shadow: 0 3px 2px rgba(0, 0, 0, 0.815);
      text-align: center;
      cursor: pointer;
    }

    .btn.btn--random,
    .btn.btn--submit {
      font-size: .95rem;
      padding: .75rem;
      border: none;
      border-radius: .25rem;
      text-transform: uppercase;
      font-weight: bold;
      grid-row: 1;
      background-color: hsl(155, 62%, 40%);
      color: white;
      transition: background-color .2s ease;
    }
    .btn:hover {
      background-color: hsl(155, 62%, 30%);
    }
    .btn:active {
      background-color: hsl(247,43%,3%);
    }

    .btn.btn--random {
      margin-bottom: 1rem;
    }
    .btn.btn--submit {
      grid-row: 3;
      background-color: hsl(12, 68%, 53%);
    }
    .btn.btn--submit:hover {
      background-color: hsl(12, 68%, 43%);
    }

    @media screen and (min-width: 600px) {

      .image-form {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr auto auto;
        grid-template-rows: 1;
        grid-gap: .5rem;
      }


      .image-form__url {
          grid-row: 1;
      }

      .btn {
        font-size: 1.25rem;
        padding: .75rem 1rem;

      }

      .btn.btn--submit {
        grid-column: 2;
        grid-row: 1;
      }
      .btn.btn--random {
        grid-column: 3;
        grid-row: 1;
        margin-bottom: 0;
      }

    }

    /* Meta */

    .meta {
      max-width: var(--mw);
      font-size: 16px;
    }


    .meta-details__summary {
      padding: 2rem 0 1rem;
    }


    /* API */
    .api-field {
      display: grid;
      grid-template-columns: auto 1fr;
    }
    .api-field + .api-field {
      margin-top: .75rem;
    }

    .api-field__label {
      grid-column: 1;
      width: 100%;
      width: 6rem;
      background-color: hsl(247,43%,9%);
      display: block;
      padding: .75rem 1rem;
      font-size: 1em;
      border-radius: .25rem 0 0 .25rem;
      text-align: right;
      color: hsla(0, 0%, 100%, 0.8);
    }

    .api-field__input {
      grid-column: 2;
      width: 100%;
      background-color: var(--c-input-bg);
      color: var(--c-input-fg);
      font-size: 1em;
      font-family: var(--ff-mono);
      border: none;
      padding: .75rem 1rem;
      border-radius: 0 .25rem .25rem 0;
    }

  </style>
</head>
<body>

  <!-- Wrapper -->
  <main class="wrapper">

    <!-- Spinner -->
    <svg class="spinner" width="32" height="32">
        <circle cx="16" cy="16" r="14" stroke="red" stroke-width="4" fill="none" stroke-dasharray="40,20" stroke-linecap="round"></circle>
    </svg>

    <!-- Error -->
    <div class="error">
      <p class="error__message">Something went wrong ☹️</p>
      <p class="error__message">Please try another image!</p>



      <details class="error-details">
        <summary class="error-details__summary">View error details</summary>
        <pre class="error-details__details error-details-message"></pre>
      </details>

    </div>

    <!-- Art -->
    <div class="art-wrapper">
      <div class="art"></div>
    </div>

    <!-- Footer -->

    <footer class="footer-content">


        <!-- Form -->
        <form class="image-form" id="image_form">

          <input class="image-form__url" type="url" name="imageURL" id="image_form_url" placeholder="Enter image URL to convert to css!" value="" required>

          <input class="btn btn--submit image-form__submit" type="submit" value="Load">

          <input class="btn btn--random image-form__random" type="button" value="Random" id="image_form_random" >

        </form>

        <!-- Meta -->
        <div class="meta">


          <details class="meta-details">
            <summary class="meta-details__summary">API</summary>
            <div class="meta-details__content">

              <div class="api-field">
                <label class="api-field__label" for="api-field-get">get</label>
                <input type="text" name="get" id="api-field-get" class="api-field__input api-fiel__input--get" readonly value="https://pixel-artist.herokuapp.com/api?url=" />
              </div>

              <div class="api-field">
                <label class="api-field__label" for="api-field-example">example</label>
                <input type="text" name="example" id="api-field-example" class="api-field__input api-field__input--example" readonly value="https://pixel-artist.herokuapp.com/api?url=https://placeimg.com/34/43/people" />
              </div>

              <div class="api-field">
                <div class="api-field__label" for="api-field-by">by</div>
                <a href="https://blackspike.com" id="api-field-by" class="api-field__input api-field__input--by">blackspike.com</a>
              </div>

            </div>
          </details>


        </div>



    </footer>

  </main>

  <script>

    const wrapperDiv = document.querySelector('.wrapper')
    const artDiv = document.querySelector('.art')
    const errorDiv = document.querySelector('.error')
    const errorDetails = document.querySelector('.error-details-message')

    // -----------------------------------------------------------------------------
    // Anime.js Animation
    // -----------------------------------------------------------------------------

    function animateIn() {
        anime({
          targets: '.art div',
          opacity: [
            {value: 0, easing: 'easeOutSine', duration: 50},
            {value: 1, easing: 'easeOutSine', duration: 75}
          ],
          delay: anime.stagger(20, {grid: [34, 43], from: 'center'})
        });
      }

    // -----------------------------------------------------------------------------
    // Pixels to array func
    // -----------------------------------------------------------------------------

    async function pixelsToArray (imageURL)  {

      // Clear art
      artDiv.innerHTML = '';
      errorDetails.innerText = '';
      errorDiv.classList.remove('error-show')

      // Show spinner
      wrapperDiv.classList.add('loading')

      // If an image url exists, send it, else just call for a rando image
      const pixelateImageUrl = imageURL ? '/api/?url=' + imageURL : '/api';

      // Call API
      const fetchPixelArrayFromAPI = await axios.get(pixelateImageUrl)
        .then(function (response) {

          // On success remove spinner
          wrapperDiv.classList.remove('loading')

          // Grab vars
          const { title, pixels, imageWidth, imageHeight, error } = response.data

          if(error) {
            errorDiv.classList.add('error-show');
            errorDetails.innerText = `error.code: ${error.code}\nerror.errno: ${error.errno}\nerror.hostname: ${error.hostname}` ;
            console.log(error);

          }

          return { title, pixels, imageWidth, imageHeight, error };
        })

        // Loop through and append new pixel divs
        if(fetchPixelArrayFromAPI.pixels) {
        fetchPixelArrayFromAPI.pixels.map(pixelArrayItem => {
          const d = document.createElement('div')
          d.classList.add('pixel');
          d.style.backgroundColor = pixelArrayItem;
          artDiv.appendChild(d);
        });
      }


      // Fancy!
      animateIn();
    }

    // Let's go!
    pixelsToArray();


    // -----------------------------------------------------------------------------
    // Random on click
    // -----------------------------------------------------------------------------

    artDiv.addEventListener('click', async function() {
      await pixelsToArray();
    });

    // -----------------------------------------------------------------------------
    // Form
    // -----------------------------------------------------------------------------

    const imageForm = document.getElementById('image_form');
    const imageFormURL = document.getElementById('image_form_url');
    const imageFormRandom = document.getElementById('image_form_random');

    // Send image url
    imageForm.addEventListener('submit', function (e) {
      e.preventDefault();
      pixelsToArray(imageFormURL.value);
    });

    // Random button
    imageFormRandom.addEventListener('click', async function() {
      await pixelsToArray();
    });

  </script>
</body>
</html>